<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><title>实现树莓派(Raspberry Pi)联网发送本机IP到绑定的微信 | Sanonz</title><meta name="author" content="Sanonz"><meta name="keywords" content="Sanonz、Web、WebGL、Font End、Developer、Mini Program"><meta name="description" content="前言通常我们使用树莓派做小主机时往往是不需要连接屏幕的，在开发树莓派时如果没有屏幕的话首先需要知道主机的 IP 才能访问树莓派。一般情况下我们不需要知道，直接可以通过 ssh pi@raspberrypi.local 来连接主机，但是有些设备没有装 avahi 是不支持 raspberrypi.local 域名访问的，还要回归本质老老实实使用 IP，这时候我们每次访问树莓派都要一些步骤去获取 IP，整个过程可能将变得麻烦。我看网上也有一些比如发邮件的解决方案，实际情况大家用微信的频率要远远高于邮"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><link rel="alternate" href="/atom.xml" title="Sanonz" type="application/atom+xml"><link rel="icon" href="/images/favicon.ico"><style type="text/css">@font-face{font-family:icomoon;src:url(/fonts/icomoon.eot?q628ml);src:url(/fonts/icomoon.eot?q628ml#iefix) format('embedded-opentype'),url(/fonts/icomoon.ttf?q628ml) format('truetype'),url(/fonts/icomoon.woff?q628ml) format('woff'),url(/fonts/icomoon.svg?q628ml#icomoon) format('svg');font-weight:400;font-style:normal}</style><link rel="stylesheet" href="/css/style.css"><!--[if lt IE 9]><style type="text/css">.nav-inner {top:0;}.author-meta {position:static;top:0;}.search-form {height:36px;}</style><script type="text/javascript" src="https://unpkg.com/html5shiv@3.7.3/dist/html5shiv.min.js"></script><![endif]--><meta name="generator" content="Hexo 4.2.1"></head><body><main class="app"><header id="header" class="header clearfix"><div id="nav" class="nav"><div class="nav-mobile"><button id="open-panel" class="open-panel nav-mobile-item"><i class="icon-documents"></i></button><h1 class="nav-mobile-title nav-mobile-item">Sanonz</h1><button id="open-menus" class="open-panel nav-mobile-item"><i class="icon-library"></i></button></div><nav id="nav-inner" class="nav-inner"><a class="nav-item" href="/"><span class="nav-text">首页</span> </a><a class="nav-item" href="/categories/front-end"><span class="nav-text">前端</span> </a><a class="nav-item" href="/categories/back-end"><span class="nav-text">后端</span> </a><a class="nav-item" href="/tags"><span class="nav-text">标签</span> </a><a class="nav-item" href="/archives"><span class="nav-text">归档</span> </a><a class="nav-item" href="/atom.xml"><span class="nav-text">订阅</span> </a><a class="nav-item" href="/about"><span class="nav-text">关于</span></a></nav></div><aside id="aside" class="aside"><div id="aside-mask" class="aside-mask"></div><div id="aside-inner" class="aside-inner"><form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"><i class="icon-search-stroke"></i></button><input type="hidden" name="sitesearch" value="https://sanonz.github.io"></form><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#前提"><span class="toc-number">2.</span> <span class="toc-text">前提</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装"><span class="toc-number">3.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#升级"><span class="toc-number">4.</span> <span class="toc-text">升级</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置"><span class="toc-number">5.</span> <span class="toc-text">配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#小结"><span class="toc-number">6.</span> <span class="toc-text">小结</span></a></li></ol></div></aside></header><div id="content" class="content"><div id="wrapper" class="wrapper"><article class="article" itemscope itemprop="blogPost"><header class="article-header"><h1 itemprop="name">实现树莓派(Raspberry Pi)联网发送本机IP到绑定的微信</h1><div class="article-meta clearfix"><a class="article-date" href="https://sanonz.github.io/2019/raspberry-ip-wechat/index.html"><i class="icon-calendar vm"></i> <time class="vm" datetime="2019-02-16T11:33:00.000Z" itemprop="datePublished">2019-02-16</time></a><div class="article-tag-list"><i class="icon-tag vm"></i> <a class="article-tag-link" href="/tags/IoT/" rel="tag">IoT</a>, <a class="article-tag-link" href="/tags/JavaScript/" rel="tag">JavaScript</a>, <a class="article-tag-link" href="/tags/Nodejs/" rel="tag">Nodejs</a>, <a class="article-tag-link" href="/tags/Raspberry/" rel="tag">Raspberry</a></div></div></header><section class="article-body markdown-body"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>通常我们使用树莓派做小主机时往往是不需要连接屏幕的，在开发树莓派时如果没有屏幕的话首先需要知道主机的 IP 才能访问树莓派。一般情况下我们不需要知道，直接可以通过 <code>ssh pi@raspberrypi.local</code> 来连接主机，但是有些设备没有装 avahi 是不支持 <code>raspberrypi.local</code> 域名访问的，还要回归本质老老实实使用 IP，这时候我们每次访问树莓派都要一些步骤去获取 IP，整个过程可能将变得麻烦。我看网上也有一些比如发邮件的解决方案，实际情况大家用微信的频率要远远高于邮箱，这个项目可以让树莓派联网后自动发送本机 IP 到微信，相比邮箱可以减少微信切邮箱…邮箱切微信的动作。安装本项目后可以节约我们的一些时间成本，还可以增加一些开发乐趣。</p><a id="more"></a> <img src="/2019/raspberry-ip-wechat/preview.png" width="375"><h2 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h2><p>作者使用的是 <a href="https://www.raspberrypi.org/downloads/raspbian/" target="_blank" rel="noopener">Raspbian Stretch Lite</a> 版本的系统，以下所用的命令都基于这个系统上跑的，不同系统可能有一些差别，如果出现了问题欢迎提 <a href="https://github.com/sanonz/raspberry-ip-wechat/issues" target="_blank" rel="noopener">Issues</a> 一起探讨。</p><p>项目地址：<a href="https://github.com/sanonz/raspberry-ip-wechat" target="_blank" rel="noopener">https://github.com/sanonz/raspberry-ip-wechat</a><br>因为这个项目用了 nodejs，所以需要先安装才能使用，如果安装过了可以跳过</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -sL https://deb.nodesource.com/setup_11.x | sudo -E bash -</span><br><span class="line">sudo apt-get install -y nodejs</span><br></pre></td></tr></table></figure><p>安装后执行以下命令查看是否成功，有版本输入则代表安装成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ node -v</span><br><span class="line">v11.9.0</span><br></pre></td></tr></table></figure><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>Git 方式安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> git@github.com:sanonz/raspberry-ip-wechat.git</span><br><span class="line">$ <span class="built_in">cd</span> raspberry-ip-wechat</span><br><span class="line">$ npm install</span><br><span class="line">$ <span class="built_in">pwd</span></span><br><span class="line">/home/htdocs/raspberry-ip-wechat <span class="comment"># 记录这个路径，下边添加自启动要用到</span></span><br></pre></td></tr></table></figure><p>或者 <a href="https://github.com/sanonz/raspberry-ip-wechat/archive/master.zip" target="_blank" rel="noopener">直接下载</a> 压缩包然后解压</p><h2 id="升级"><a href="#升级" class="headerlink" title="升级"></a>升级</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> raspberry-ip-wechat</span><br><span class="line">$ git pull</span><br></pre></td></tr></table></figure><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>修改 <code>template.json</code> 配置文件</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"userIds"</span>: [<span class="string">"o_bBF50Ewg8VYpIRJLYuo305d7EY"</span>],</span><br><span class="line">  <span class="attr">"template_id"</span>: <span class="string">"4YscLc2uaCnsdrEdUJ9HGAGAkdBcEQM9bUBy0gs69Hw"</span>,</span><br><span class="line">  <span class="attr">"url"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="attr">"data"</span>: &#123;</span><br><span class="line">    <span class="attr">"first"</span>: &#123;</span><br><span class="line">      <span class="attr">"value"</span>: <span class="string">"树莓派开发板网络连接状态"</span>,</span><br><span class="line">      <span class="attr">"color"</span>: <span class="string">"#856404"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"keyword1"</span>: &#123;</span><br><span class="line">      <span class="attr">"value"</span>: <span class="string">"发送日期"</span>,</span><br><span class="line">      <span class="attr">"color"</span>: <span class="string">"#999999"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"keyword2"</span>: &#123;</span><br><span class="line">      <span class="attr">"value"</span>: <span class="string">"连接成功"</span>,</span><br><span class="line">      <span class="attr">"color"</span>: <span class="string">"#28a745"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"remark"</span>: &#123;</span><br><span class="line">      <span class="attr">"value"</span>: <span class="string">"服务器IP地址: &#123;ip&#125; (&#123;type&#125;)"</span>,</span><br><span class="line">      <span class="attr">"color"</span>: <span class="string">"#721c24"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>userIds</strong> - 接收者的微信 OpenID，微信搜索公众号 <code>wxpusher</code> 关注后把自动推送的 userId 填写到这里。</li><li><strong>template_id</strong> - 模板 ID，无需理会。</li><li><strong>url</strong> - 如果填写推送消息则可以点击，为空则不能点击。</li><li><strong>data</strong> - 推送的详细信息，<code>value</code> 与 <code>color</code> 字段都可以更改。支持模板，{ip} 会被替换成主机的 IP，{type} 会被替换成是 wifi/还是网线连接的。</li></ul><p>添加开机启动脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ sudo nano /etc/rc.local</span><br><span class="line"><span class="comment">#!/bin/sh -e</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># rc.local</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This script is executed at the end of each multiuser runlevel.</span></span><br><span class="line"><span class="comment"># Make sure that the script will "exit 0" on success or any other</span></span><br><span class="line"><span class="comment"># value on error.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># In order to enable or disable this script just change the execution</span></span><br><span class="line"><span class="comment"># bits.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># By default this script does nothing.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Print the IP address</span></span><br><span class="line">_IP=$(hostname -I) || <span class="literal">true</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$_IP</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">printf</span> <span class="string">"My IP address is %s\n"</span> <span class="string">"<span class="variable">$_IP</span>"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">node /home/htdocs/raspberry-ip-wechat/index.js <span class="comment"># 增加这一行，放在 `exit 0` 前边，路径使用上方记录的</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure><p>添加完成后按 <code>ctrl+X</code> 然后按 <code>Y</code> 保存修改</p><p>然后赶紧重启你的树莓派试下吧，如果不出什么问题的话，你将收到一条树莓派给你发的微信。</p><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>这个项目用了微信企业号的模板消息，申请需要提供公司资料认证，对于个人而言门槛还是比较高，所以本项目用了第三方提供的接口进行推送，稳定性及安全性不能保证，如果要求比较高请自行研究替换为自己的企业号。</p><p>至此结束，感谢阅读。</p></section></article><div class="comments"><div id="comments"></div><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script>new Gitalk({clientID:"2f728eb14f7e549408f7",clientSecret:"90be74e913959dcf39fbfed54458bdd20f95ac30",repo:"sanonz.github.io",owner:"sanonz",admin:["sanonz"],id:"42f32e9e2b9a92fbcb740ef67b4db013",distractionFreeMode:!0,title:"实现树莓派(Raspberry Pi)联网发送本机IP到绑定的微信",body:"https://sanonz.github.io/2019/raspberry-ip-wechat/",labels:["JavaScript","Nodejs","IoT","Raspberry"]}).render("comments")</script></div></div></div><a id="pagenext" href="/2018/offscreen-render-target-with-three-js/" class="article-next" title="使用 Three.js 的 RenderTarget 实现离屏渲染"><i class="icon-arrow-right"></i></a> <a id="pageprev" href="/2019/eth-transaction-for-wep3-and-infura/" class="article-prev" title="以太坊概念与使用 wep3/infura 实现以太币及合约币交易流程"><i class="icon-arrow-left"></i></a><footer class="footer">Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, Theme by <a href="https://github.com/sanonz/hexo-theme-concise" target="_blank">Concise</a><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?e4027971a230b210f4671f485b33846a";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></footer></main><script type="text/javascript" src="https://unpkg.com/jquery@1.9.1/jquery.min.js"></script><script type="text/javascript">$(function(){var n={nav:$("#nav"),aside:$("#aside"),asideInner:$("#aside-inner"),navInner:$("#nav-inner")},e=!1;function i(){"none"!==n.navInner.css("display")&&n.navInner.css("display","")}n.asideInner.on("webkitAnimationEnd mozAnimationEnd oAnimationEnd oanimationend animationend",function(){n.aside.hasClass("mobile-open")?n.aside.removeClass("mobile-open"):n.aside.removeClass("mobile-close panel-show"),e=!1}),$("#open-panel, #aside-mask").on("click",function(){e||(n.aside.hasClass("panel-show")?n.aside.addClass("mobile-close"):n.aside.addClass("mobile-open panel-show"))}),$("#open-menus").on("click",function(){n.navInner.slideToggle("normal",i)}),window.innerWidth<=960&&setTimeout(function(){n.navInner.slideUp("normal",i)},3e3),$(window).on("resize",function(){960<$(this).width()&&n.navInner.css("display","")})})</script><script src="/js/scrollspy.min.js"></script><script type="text/javascript">$(document.body).scrollspy({target:"#aside-inner"}),$(window).on("resize",function(){var e=$("#header").width(),t=$("#wrapper").width(),i=($(this).width()-e-t)/2/2,r=$("#pageprev"),d=$("#pagenext"),s=(r.width()+d.width())/2;if(s<i){var n=i-s/2,o={position:"fixed",top:"50%",marginTop:-(r.width()+d.width())/4};r.css($.extend({left:e+n},o)),d.css($.extend({right:n},o))}else r.removeAttr("style"),d.removeAttr("style")}).trigger("resize")</script></body></html>